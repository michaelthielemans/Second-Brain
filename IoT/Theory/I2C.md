#IoT
Inter-IC bus

- Developed by Philips in the late 80s
- It only requires 2 wires:
	- SCK: Serial Clock
	- SDA: Serial Data
- It is slow
- It is a synchronous protocol, It has a common clock (SCK from the master)
- Master/slave or controller/peripherals
- BI-directional communication
- For short distances
- Every device has a preset-ID, with addressing the controller can target a specific device
- The bus is Active LOW -> pull up resistors are used so Voltage = Vcc at rest
- 7bit addressing = (128) in practive 112 devices
- Can also use a 10 bit addressing = (1024) in practice = 1008 devices
## Addressing:
- Each device has a preset ID, this ID need to be unique in the bus.
- Address notation is in hexadecimal notation. "0x" always precedes the address to show it is in a hexadecimal notation. The "0x" is not part of the address itself.
## Speed:
Multiple speeds are possible:
	- standard mode (SM): 100kb/s
	- fast mode (FM): 400kb/s
	- high speed mode (HS): 3.4Mb/s
Configuring the speed can be done by setting the frequency of the clock signal that is generated by the master/controller. This can be done with the C or Python library
```C
#for example on a arduino microcontroller in C code you can
Wire.setClock(400000); # this sets the clock to 400KHz
```

**Considerations for speed configuration**
1. **Compatibility:** Ensure all devices on the bus support the selected speed.
2. **Pull-up Resistors:** The values of the pull-up resistors affect signal integrity at higher speeds. Lower resistance is better for fast modes, but the value should balance power consumption and rise time.
3. **Signal Integrity:** For high-speed mode, the bus capacitance should be minimized to prevent signal distortion.
4. **Clock Stretching:** If using devices that rely on clock stretching, ensure your master device supports it.

When a device cannot handle the speed is can pull the clock signal low.
## Clock
when the clock is in a high state the value of the SDA line will be registered.
## Data sequence
8 bit (one Byte) is one sequence
 
1. Start bit (1 bit)
2. The first sequence that is 8 bit (1 Byte)
	1.  Contains the target device address (7 bit)
	2. plus the R/W bit. this defines if the master wants to read data from the device or write data to the device.
	3. If the device has a register, the controller need to send the 7 bit address completed with a write bit (0). The device now knows that the controller wants to send another address (the register address)
3. Acknowledge bit (1 bit)
4. The second sequence contains the internal register address (8bit)
	1. a internal register is needed for example when a device has multiple sensors and each register contains a value from a specific sensor.
5. Acknowledge bit (1 bit)
6. The actual data payload (8 bit), MSB first
7. Stop bit (1 bit)

##### Start transmission (start bit):
When the SDA line falls from High to LOW = start of transmission

##### Stop transmission (stop bit):
When the SDA line 

| first bit | 7bit addressing       | R/W bit                                 | ACK bit                                                      | 8bit data | stop bit |
| --------- | --------------------- | --------------------------------------- | ------------------------------------------------------------ | --------- | -------- |
| start     | address of the device | bit = 0 -> data is written to device    | The device itself should now make the sda low or high to ack |           |          |
|           |                       | bit = 1 -> data is read from the device | NACK -> SDA = high<br>ACK -> SDA = LOW                       |           |          |

One ore multiple data sequences are transferred until a stop bit is send/received.


## Pull up resistors:

The pull ups has the function to bring the dataline and clock to a high signal at rest.
Pull up resistors are installed between Vcc and the SDA (dataline) and SCL(clock) and Vcc
Vcc is in the same voltage as the voltage of the SDA, SCL. For microcontrollers 5V for microprocessors 3.3V

Resistor values:
- 2K Ohm for High Speed Mode
- 4K7 Ohms for 400Kb/s
- 10K Ohm for 100Kb/s

Why does the value of the pull up resistor affects the max speed of the bus. A higher resistance means lower energy consumption but also a slower transition from LOW signal back to HIGH signal.


## Start, R/W bit, ack and stop bit

#### Start bit
At rest both lines SDA and SCK are high ( pull up resistor). The controller initiates the transmission by sending a start byte. this is done by pulling the SDA pin low at that time the SCK is still high. From that time the clock starts and the controller can start sending the target address.

#### 7 Address bits

#### R/W bit
The last bit in the 8 bit sequence is the Read or Write bit. 
R/W = LOW -> The next data sequence will write data to the device
R/W = HIGH -> The controller will read data from the device

#### ACK and NACK bit
After every 8 bit sequence the receiver sends an acknowledge or NACK bit. This bit indicates if the receiver has received the bit sequence correctly
- ACK = SDA is LOW
- NACK = SDA is HIGH

In case the device has was not able to acknowledge due to the fact is was still processing the data or faulty transmission it leaves the SDA HIGH. The controller can send the data again or should decide what he should do.

#### Stop bit

As long as there is no stop bit send or received it is possible to keep transmitting 8 bit data sequences ( if every sequence is correctly ended with an ACK at least).

SDA rises from LOW to HIGH when the Clock signal is High
## Serial connections
#### Pins:
- RX: receive
- TX: Transmit